create database QUANLYBANQUANAO;
go
use QUANLYBANQUANAO;
go
	CREATE TABLE KHACHHANG
	(
		MAKHACHHANG NVARCHAR (10) NOT NULL,
		TENKHACHHANG NVARCHAR (30) NOT NULL,
		DIACHI NVARCHAR (45),
		GIOITINH BIT,
		SDT NVARCHAR (15),
		NGAYSINH DATETIME,
		CONSTRAINT PK_KHACHHANG PRIMARY KEY (MAKHACHHANG) 
	);
	CREATE TABLE NHANVIEN
	(
		MANHANVIEN NVARCHAR (10) NOT NULL,
		TENNHANVIEN NVARCHAR (30) NOT NULL,
		DIACHI NVARCHAR (45),
		GIOITINH BIT,
		SDT NVARCHAR (15),
		NGAYSINH DATETIME,
		SOCCCD NVARCHAR (20),
		CONSTRAINT PK_NHANVIEN PRIMARY KEY (MANHANVIEN)
	);
	CREATE TABLE NHAPHANPHOI
	(
		MANPP NVARCHAR (10) NOT NULL,
		TENNHAPP NVARCHAR (30) NOT NULL,
		DIACHI NVARCHAR (45),
		SDT NVARCHAR (15),
		CONSTRAINT PK_NHAPHANPHOI PRIMARY KEY (MANPP)
	);
		CREATE TABLE LOAISANPHAM
	(
		MALOAI NVARCHAR (10) NOT NULL,
		TENLOAI NVARCHAR (30) NOT NULL,
		CONSTRAINT PK_LOAISANPHAM PRIMARY KEY (MALOAI)
	);
		CREATE TABLE KHO
	(
		MAKHO NVARCHAR (10) NOT NULL,
		TENKHO NVARCHAR (30) NOT NULL,
		CONSTRAINT PK_KHO PRIMARY KEY (MAKHO)
	);
		CREATE TABLE SANPHAM
	(
		MASANPHAM NVARCHAR (10) NOT NULL,
		TENSANPHAM NVARCHAR (30) NOT NULL,
		TINHTRANGSP NVARCHAR (45),
		GIATIEN MONEY,
		MANPP NVARCHAR (10) NOT NULL,
		MAKHO NVARCHAR (10) NOT NULL,
		MALOAI NVARCHAR (10) NOT NULL,
		CONSTRAINT PK_SANPHAM PRIMARY KEY (MASANPHAM),
		CONSTRAINT FK_SANPHAM_MANPP FOREIGN KEY (MANPP) REFERENCES NHAPHANPHOI (MANPP),
		CONSTRAINT FK_SANPHAM_MAKHO FOREIGN KEY (MAKHO) REFERENCES KHO (MAKHO),
		CONSTRAINT FK_SANPHAM_MALOAI FOREIGN KEY (MALOAI) REFERENCES LOAISANPHAM (MALOAI)
	);
		CREATE TABLE HOADON
	(
		MAHOADON NVARCHAR (10) NOT NULL,
		NGAYBANHANG DATETIME,
		TONGTIEN MONEY,
		GIAMGIA NVARCHAR (10) ,
		MAKHACHHANG NVARCHAR (10) NOT NULL,
		MANHANVIEN NVARCHAR (10) NOT NULL,
		CONSTRAINT PK_HOADON PRIMARY KEY (MAHOADON),
		CONSTRAINT FK_HOADON_MAKHACHHANG FOREIGN KEY (MAKHACHHANG) REFERENCES KHACHHANG (MAKHACHHANG),
		CONSTRAINT FK_HOADON_MANHANVIEN FOREIGN KEY (MANHANVIEN) REFERENCES NHANVIEN (MANHANVIEN)
	);
		CREATE TABLE SPVAHD
	(
		MASANPHAM NVARCHAR (10) NOT NULL,
		MAHOADON NVARCHAR (10) NOT NULL,
		SOLUONG SMALLINT,
		CONSTRAINT PK_SPANDHD PRIMARY KEY (MASANPHAM,MAHOADON),
		CONSTRAINT FK_SPVAHD_MASANPHAM FOREIGN KEY (MASANPHAM) REFERENCES SANPHAM (MASANPHAM),
		CONSTRAINT FK_SPVAHD_MAHOADON FOREIGN KEY (MAHOADON) REFERENCES HOADON (MAHOADON)
	);
		CREATE TABLE SIZE
	(
		SIZE NVARCHAR (10) NOT NULL,
		MASANPHAM NVARCHAR (10) NOT NULL,
		CONSTRAINT PK_SIZE PRIMARY KEY (SIZE,MASANPHAM)	
	);
	ALTER TABLE SIZE ADD
	CONSTRAINT FK_SIZE_MASANPHAM FOREIGN KEY (MASANPHAM) REFERENCES SANPHAM (MASANPHAM)
	
	INSERT INTO NHAPHANPHOI
VALUES
(

     N'N01',
	 N'ADIDAS',
	 N'HANOI',
	 N'038319542'
)
INSERT INTO NHAPHANPHOI
VALUES
(
     N'N02',
	 N'NIKE',
	 N'HUNGYEN',
	 N'0862256102'
)
--3
INSERT INTO NHAPHANPHOI
VALUES
(

     N'N03',
	 N'PUMA',
	 N'VINHPHUC',
	 N'082659406'
)
--4
INSERT INTO NHAPHANPHOI
VALUES
(

     N'N04',
	 N'VANS',
	 N'HATINH',
	 N'0365982594'
)
--5
INSERT INTO NHAPHANPHOI
VALUES
(

     N'N05',
	 N'GUCCI',
	 N'HANOI',
	 N'0359251161'
)
INSERT INTO KHO
VALUES
(

     N'K1',
	 N'KHO1'
)
--2
INSERT INTO KHO
VALUES
(
     N'K2',
	 N'KHO2'
)
--3
INSERT INTO KHO
VALUES
(
     N'K3',
	 N'KHO3'
)
--4
INSERT INTO KHO
VALUES
(
     N'K4',
	 N'KHO4'
)
--5
INSERT INTO KHO
VALUES
(
     N'K5',
	 N'KHO5'
)
--1
INSERT INTO LOAISANPHAM
VALUES
(
     N'L1',
	 N'DABONG'
)
--2
INSERT INTO LOAISANPHAM
VALUES
(
     N'L2',
	 N'CAULONG'
)
--3
INSERT INTO LOAISANPHAM
VALUES
(
     N'L3',
	 N'BOI'
)
--4
INSERT INTO LOAISANPHAM
VALUES
(
     N'L4',
	 N'GYM'
)
--5
INSERT INTO LOAISANPHAM
VALUES
(
     N'L5',
	 N'BONGRO'
)
--5 BANG KHACHHANG
INSERT INTO KHACHHANG
VALUES
(
     N'KH1',
	 N'DAOKIMDIEP',
	 N'HUNGYEN',
	 1,
	 N'0333445566',
	 '2002/02/04'
)
--2
INSERT INTO KHACHHANG
VALUES
(
     N'KH2',
	 N'VUONGDANHTRUONG',
	 N'HANOI',
	 1,
	 N'0826599406',
	 '2002/11/13'
)
--3
INSERT INTO KHACHHANG
VALUES
(
     N'KH3',
	 N'PHAMQUANGHUNG',
	 N'HUNGYEN',
	 1,
	 N'0123456789',
	 '2002/09/04'
)
--4
INSERT INTO KHACHHANG
VALUES
(
     N'KH4',
	 N'NGUYENTHUPHUONG',
	 N'HANOI',
	 0,
	 N'0888888888',
	 '2002/08/22'
)
--5
INSERT INTO KHACHHANG
VALUES
(
     N'KH5',
	 N'BUITHUTHUY',
	 N'HATINH',
	 0,
	 N'0999999999',
	 '2002/09/07'
)
--5 BANG NHANVIEN
--1
INSERT INTO NHANVIEN
VALUES
(
     N'NV1',
	 N'NGUYENTIENKHANH',
	 N'HANOI',
	 1,
	 N'0789456321',
	 '2002/09/20',
	 N'001234567891'
)
--2
INSERT INTO NHANVIEN
VALUES
(
     N'NV2',
	 N'DOMANHDUNG',
	 N'HAIDUONG',
	 1,
	 N'0387778880',
	 '2002/02/13',
	 N'001344565767'
)
--3
INSERT INTO NHANVIEN
VALUES
(
     N'NV3',
	 N'DODUYCHIEN',
	 N'THAIBINH',
	 1,
	 N'0789456321',
	 '2002/09/20',
	 N'001234567891'
)
--4
INSERT INTO NHANVIEN
VALUES
(
     N'NV4',
	 N'NGUYENTHANHAN',
	 N'HANOI',
	 1,
	 N'0987694234',
	 '2002/01/20',
	 N'000111679871'
)
--5
INSERT INTO NHANVIEN
VALUES
(
     N'NV5',
	 N'NGUYENTRIEUQUAN',
	 N'THAIBINH',
	 1,
	 N'0789456321',
	 '2002/04/08',
	 N'000088899971'
)

INSERT INTO HOADON
VALUES
(
     N'HD1',
	 '2022/09/09',
	 N'300000',
	 N'10000',
	 N'KH1',
	 N'NV1'
)
--2
INSERT INTO HOADON
VALUES
(
     N'HD2',
	 '2022/09/09',
	 N'350000',
	 N'10000',
	 N'KH1',
	 N'NV1'
)
--3
INSERT INTO HOADON
VALUES
(
     N'HD3',
	 '2022/09/09',
	 N'400000',
	 N'20000',
	 N'KH2',
	 N'NV2'
)
--4
INSERT INTO HOADON
VALUES
(
     N'HD4',
	 '2022/09/09',
	 N'300000',
	 N'10000',
	 N'KH3',
	 N'NV3'
)
--5
INSERT INTO HOADON
VALUES
(
     N'HD5',
	 '2022/10/01',
	 N'500000',
	 N'20000',
	 N'KH4',
	 N'NV5'
)
--6
INSERT INTO HOADON
VALUES
(
     N'HD6',
	 '2022/10/02',
	 N'450000',
	 N'20000',
	 N'KH4',
	 N'NV4'
)
--7

INSERT INTO HOADON
VALUES
(
     N'HD7',
	 '2022/10/03',
	 N'650000',
	 N'50000',
	 N'KH5',
	 N'NV5'
)
--8
INSERT INTO HOADON
VALUES
(
     N'HD8',
	 '2022/10/03',
	 N'700000',
	 N'50000',
	 N'KH5',
	 N'NV4'
)
--9
INSERT INTO HOADON
VALUES
(
     N'HD9',
	 '2022/10/05',
	 N'430000',
	 N'10000',
	 N'KH3',
	 N'NV2'
)
--10
INSERT INTO HOADON
VALUES
(
     N'HD10',
	 '2022/10/09',
	 N'600000',
	 N'30000',
	 N'KH5',
	 N'NV1'
)
--5 BANG SAN PHAM
INSERT INTO SANPHAM
VALUES
(
	N'SP1',
	N'AOPHONG',
	N'CON',
	N'150000',
	N'N01',
	N'K1',
	N'L1'
)
INSERT INTO SANPHAM
VALUES
(
	N'SP2',
	N'AOBALO',
	N'CON',
	N'450000',
	N'N05',
	N'K1',
	N'L3'
)

INSERT INTO SANPHAM
VALUES
(
	N'SP3',
	N'AOKHOAC',
	N'CON',
	N'500000',
	N'N02',
	N'K3',
	N'L2'
)
INSERT INTO SANPHAM
VALUES
(
	N'SP4',
	N'QUANSHORT',
	N'CON',
	N'350000',
	N'N03',
	N'K4',
	N'L2'
)
INSERT INTO SANPHAM
VALUES
(
	N'SP5',
	N'QUANDAI',
	N'CON',
	N'250000',
	N'N04',
	N'K4',
	N'L2'
)
INSERT INTO SIZE
VALUES
(
	N'S',
	N'SP1'
)
INSERT INTO SIZE
VALUES
(
	N'X',
	N'SP2'
)
INSERT INTO SIZE
VALUES
(
	N'XL',
	N'SP3'
)INSERT INTO SIZE
VALUES
(
	N'S',
	N'SP4'
)
INSERT INTO SIZE
VALUES
(
	N'S',
	N'SP5'
)
INSERT INTO SPVAHD
VALUES
(
	N'SP1',
	N'HD1',
	'2'
)
INSERT INTO SPVAHD
VALUES
(
	N'SP2',
	N'HD2',
	'1'
)
INSERT INTO SPVAHD
VALUES
(
	N'SP3',
	N'HD3',
	'3'
)
INSERT INTO SPVAHD
VALUES
(
	N'SP4',
	N'HD3',
	'2'
)
INSERT INTO SPVAHD
VALUES
(
	N'SP5',
	N'HD2',
	'2'
)
INSERT INTO SPVAHD
VALUES
(
	N'SP3',
	N'HD2',
	'1'
)
INSERT INTO SPVAHD
VALUES
(
	N'SP2',
	N'HD4',
	'4'
)

--thêm 'số lượng' vào bảng 'sản phẩm', thêm dữ liệu cho thuộc tính 'số lượng'
	ALTER TABLE SANPHAM ADD SOLUONG INT NULL

		UPDATE SANPHAM 
		SET SOLUONG = 77
		WHERE MASANPHAM = N'SP1'
	UPDATE SANPHAM 
		SET SOLUONG = 100
		WHERE MASANPHAM = N'SP2'
	UPDATE SANPHAM 
		SET SOLUONG = 30
		WHERE MASANPHAM = N'SP3'
	UPDATE SANPHAM 
		SET SOLUONG = 34
		WHERE MASANPHAM = N'SP4'
	UPDATE SANPHAM 
		SET SOLUONG = 70
		WHERE MASANPHAM = N'SP5'

-- 15 CÂU LỆNH TRUY VẤN SQL
--câu 1: cho biết mã sản phẩm, tên sản phẩm của các sản phẩm có size 's'
	SELECT SIZE.MASANPHAM, TENSANPHAM
	FROM SANPHAM INNER JOIN SIZE
	ON SANPHAM.MASANPHAM = SIZE.MASANPHAM
	WHERE SIZE= N'S'
 --câu 2: Đếm số lượng nhân viên bán hàng của shop
	SELECT COUNT(*) as soluong FROM NHANVIEN
 --câu 3: Hiển thị nhân viên có độ tuổi là 20
		SELECT TENNHANVIEN FROM NHANVIEN
		WHERE YEAR(GETDATE())-YEAR(NGAYSINH) = 20
--câu 4: cho biết hóa đơn số 1 do nhân viên nào lập và ngày bán hàng ấy?
	SELECT HOADON.MANHANVIEN,TENNHANVIEN, NGAYBANHANG
	FROM NHANVIEN INNER JOIN HOADON
	ON NHANVIEN.MANHANVIEN = HOADON.MANHANVIEN
	WHERE MAHOADON = N'HD1'
--câu 5: cho biết mã sp, tên sp và số lượng hiện có?
	SELECT MASANPHAM,TENSANPHAM,SOLUONG
	FROM SANPHAM
--câu 6: Cho biết danh sách các đối tác cung cấp sản phẩm cho shop?
    SELECT * FROM NHAPHANPHOI
--câu 7: Lấy thông tin tất cả các sản phẩm kèm theo giá bán mới sau khi đã giảm 10%
	SELECT *, GIATIEN * 0.9 AS GIATIENMOI
	FROM SANPHAM
--câu 8: Địa chỉ, sđt, của nhà phân phối có tên ADIDAS
    SELECT * FROM NHAPHANPHOI
    WHERE TENNHAPP = N'ADIDAS'
--câu 9: nhân viên nào trong cửa hàng bán được nhiều hàng nhất và số lượng bán được là bao nhiêu?
	SELECT NHANVIEN.MANHANVIEN,TENNHANVIEN,SUM(SOLUONG) as soluong
	FROM (NHANVIEN INNER JOIN HOADON 
	ON NHANVIEN.MANHANVIEN = HOADON.MANHANVIEN
	INNER JOIN SPVAHD
	ON HOADON.MAHOADON = SPVAHD.MAHOADON)
	GROUP BY NHANVIEN.MANHANVIEN, TENNHANVIEN
	HAVING SUM(SOLUONG) >= ALL(SELECT SUM(SOLUONG)
	FROM (NHANVIEN INNER JOIN HOADON 
	ON NHANVIEN.MANHANVIEN = HOADON.MANHANVIEN)
	INNER JOIN SPVAHD ON
	HOADON.MAHOADON = SPVAHD.MAHOADON
	GROUP BY NHANVIEN.MANHANVIEN,TENNHANVIEN)
--câu 10: nhà phân phối ADIDAS đã cung cấp những mặt hàng nào?
	SELECT MASANPHAM,TENSANPHAM
	FROM SANPHAM INNER JOIN NHAPHANPHOI
	ON SANPHAM.MANPP = NHAPHANPHOI.MANPP
	WHERE TENNHAPP=N'ADIDAS'
--câu 11: cho biết mã sản phẩm, tên sản phẩm có giá trị lớn hơn 350000 và số lượng hiện có ít hơn 50
	SELECT MASANPHAM,TENSANPHAM
	FROM SANPHAM
	WHERE GIATIEN>350000 AND SOLUONG<50
--câu 12: mỗi nhân viên của cửa hàng đã lập bao nhiêu hóa đơn 
	SELECT NHANVIEN.MANHANVIEN,TENNHANVIEN, COUNT(MAHOADON) as soluonghoadon
	FROM NHANVIEN LEFT OUTER JOIN HOADON
	ON NHANVIEN.MANHANVIEN = HOADON.MANHANVIEN
	GROUP BY NHANVIEN.MANHANVIEN,TENNHANVIEN
--câu 13: họ tên và địa chỉ,số điện thoại của các nhân viên làm việc trong cửa hàng
	SELECT TENNHANVIEN,DIACHI,SDT
	FROM NHANVIEN
--câu 14: cho biết mỗi sản phẩm trong cửa hàng do nhà phân phối nào cung cấp?
	SELECT MASANPHAM,TENSANPHAM, NHAPHANPHOI.MANPP,TENNHAPP
	FROM SANPHAM INNER JOIN NHAPHANPHOI
	ON SANPHAM.MANPP = NHAPHANPHOI.MANPP
 --câu 15: Hiển thị hóa đơn bán được theo chiều giảm dần của tổng số tiền
    SELECT * FROM HOADON
    ORDER BY TONGTIEN DESC










